
<!DOCTYPE html>
<html>
<head>
  <title>Canvas SDK Simple Demo</title>
  <script src="https://qhsandbox-dev-ed.develop.my.salesforce.com/canvas/sdk/js/65.0/canvas-all.js"></script>
</head>
<body>
  <h2>Salesforce Canvas SDK Demo</h2>
  <div id="info">Loading Canvas context...</div>
  
  <button onclick="getOAuthToken()">Get OAuth Token</button>
  <button onclick="callSalesforceAPI()">Call Salesforce API</button>
  <button onclick="closeCanvasTab()">Close Canvas Tab</button>
  
  <script>
    let signedRequestData = null;
    Sfdc.canvas.client.refreshSignedRequest(function(data) {
      signedRequestData = data;
      if(data && data.context) {
        const user = data.context.user;
        const recordId = data.context.environment.parameters.recordId || 'N/A';
        document.getElementById("info").innerHTML = `
          <p><b>User ID:</b> ${user.userId}</p>
          <p><b>Username:</b> ${user.userName}</p>
          <p><b>Record ID:</b> ${recordId}</p>
        `;
      } else {
        document.getElementById("info").innerText = "Failed to load Canvas context";
      }
    });

    function getOAuthToken() {
      Sfdc.canvas.oauth.token(signedRequestData.client, function(response) {
        alert("OAuth Token: " + response.token);
      });
    }

    function callSalesforceAPI() {
      const recordId = signedRequestData.context.environment.parameters.recordId;
      if(!recordId) {
        alert("Record ID not found in context.");
        return;
      }
      const url = `/services/data/v59.0/sobjects/Opportunity/${recordId}`;

      Sfdc.canvas.client.ajax({
        url: url,
        method: "GET",
        client: signedRequestData.client
      }, function(response) {
        if(response.status === 200 && response.payload) {
          alert("Opportunity Name: " + response.payload.Name);
        } else {
          alert("Failed to get Opportunity data.");
        }
      });
    }

    function closeCanvasTab() {
      Sfdc.canvas.publisher.publish({
        name: "canvas_tab_close",
        payload: { refresh: true }
      });
    }
  </script>
</body>
</html>
